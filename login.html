<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>THE VICTOR BIKES — Login</title>
  
  <!-- CSS Files -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/responsive.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-page">
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo">
        <div class="logo-icon">VB</div>
        <div class="logo-text">
          <h1>THE VICTOR BIKES</h1>
          <span>Bicycle Store in Nigeria</span>
        </div>
      </a>
      
      <div class="nav-actions">
        <a href="index.html" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Store
        </a>
      </div>
    </div>
  </nav>

  <!-- Login Container -->
  <main class="login-main">
    <div class="login-container">
      <!-- Login Header -->
      <div class="login-header">
        <div class="logo">
          <div class="logo-icon">VB</div>
          <div>
            <h2>Welcome to Victor Bikes</h2>
            <p>Login to your account</p>
          </div>
        </div>
      </div>

      <!-- Login Tabs -->
      <div class="login-tabs">
        <button class="login-tab active" data-tab="login">
          <i class="fas fa-sign-in-alt"></i> Login
        </button>
        <button class="login-tab" data-tab="register">
          <i class="fas fa-user-plus"></i> Register
        </button>
        <button class="login-tab" data-tab="reset">
          <i class="fas fa-key"></i> Reset
        </button>
      </div>

      <!-- Login Form -->
      <div class="login-form">
        <!-- Login Section -->
        <div id="login" class="form-section active">
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail" class="form-label">Email Address</label>
              <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input type="email" id="loginEmail" class="form-input" placeholder="you@example.com" required>
              </div>
              <div class="error-message" id="loginEmailError"></div>
            </div>

            <div class="form-group">
              <label for="loginPassword" class="form-label">Password</label>
              <div class="input-with-icon">
                <i class="fas fa-lock"></i>
                <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" required>
                <button type="button" class="toggle-password" data-target="loginPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="error-message" id="loginPasswordError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <input type="checkbox" id="rememberMe">
                Remember me
              </label>
            </div>

            <div class="form-footer">
              <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-sign-in-alt"></i> Sign In
              </button>
            </div>
          </form>

          <div class="divider">
            <span>Or continue with</span>
          </div>

          <div class="social-login">
            <button type="button" class="social-btn google" id="googleLogin">
              <i class="fab fa-google"></i> Google
            </button>
            <button type="button" class="social-btn facebook" id="facebookLogin">
              <i class="fab fa-facebook"></i> Facebook
            </button>
          </div>

          <div class="form-links">
            <p>
              Don't have an account? 
              <a href="#" class="switch-tab" data-tab="register">Sign up</a>
            </p>
            <p>
              <a href="#" class="switch-tab" data-tab="reset">Forgot your password?</a>
            </p>
          </div>
        </div>

        <!-- Register Section -->
        <div id="register" class="form-section">
          <form id="registerForm">
            <div class="form-group">
              <label for="registerName" class="form-label">Full Name</label>
              <div class="input-with-icon">
                <i class="fas fa-user"></i>
                <input type="text" id="registerName" class="form-input" placeholder="John Doe" required>
              </div>
              <div class="error-message" id="registerNameError"></div>
            </div>

            <div class="form-group">
              <label for="registerEmail" class="form-label">Email Address</label>
              <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input type="email" id="registerEmail" class="form-input" placeholder="you@example.com" required>
              </div>
              <div class="error-message" id="registerEmailError"></div>
            </div>

            <div class="form-group">
              <label for="registerPhone" class="form-label">Phone Number</label>
              <div class="input-with-icon">
                <i class="fas fa-phone"></i>
                <input type="tel" id="registerPhone" class="form-input" placeholder="0806 246 3468" required>
              </div>
              <div class="error-message" id="registerPhoneError"></div>
            </div>

            <div class="form-group">
              <label for="registerPassword" class="form-label">Password</label>
              <div class="input-with-icon">
                <i class="fas fa-lock"></i>
                <input type="password" id="registerPassword" class="form-input" placeholder="At least 8 characters" required>
                <button type="button" class="toggle-password" data-target="registerPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="error-message" id="registerPasswordError"></div>
            </div>

            <div class="form-group">
              <label for="registerConfirm" class="form-label">Confirm Password</label>
              <div class="input-with-icon">
                <i class="fas fa-lock"></i>
                <input type="password" id="registerConfirm" class="form-input" placeholder="Confirm your password" required>
                <button type="button" class="toggle-password" data-target="registerConfirm">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="error-message" id="registerConfirmError"></div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <input type="checkbox" id="acceptTerms" required>
                I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
              </label>
              <div class="error-message" id="termsError"></div>
            </div>

            <div class="form-footer">
              <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-user-plus"></i> Create Account
              </button>
            </div>
          </form>

          <div class="form-links">
            <p>
              Already have an account? 
              <a href="#" class="switch-tab" data-tab="login">Sign in</a>
            </p>
          </div>
        </div>

        <!-- Reset Password Section -->
        <div id="reset" class="form-section">
          <form id="resetForm">
            <div class="form-group">
              <label for="resetEmail" class="form-label">Email Address</label>
              <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input type="email" id="resetEmail" class="form-input" placeholder="you@example.com" required>
              </div>
              <div class="error-message" id="resetEmailError"></div>
            </div>

            <p class="reset-instructions">
              Enter your email address and we'll send you a link to reset your password.
            </p>

            <div class="form-footer">
              <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-paper-plane"></i> Send Reset Link
              </button>
            </div>
          </form>

          <div class="form-links">
            <p>
              <a href="#" class="switch-tab" data-tab="login">
                <i class="fas fa-arrow-left"></i> Back to login
              </a>
            </p>
          </div>
        </div>
      </div>

      <!-- Business Info -->
      <div class="login-business-info">
        <p>
          <i class="fas fa-map-marker-alt"></i> Palm City St, Abuja 900108, FCT
          <br>
          <i class="fas fa-phone"></i> 0806 246 3468
          <br>
          <a href="index.html">← Back to store</a>
        </p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p>&copy; 2024 THE VICTOR BIKES. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript Files -->
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // Login Page Script
    class LoginPage {
      constructor() {
        this.init();
      }

      init() {
        this.setupTabs();
        this.setupForms();
        this.setupPasswordToggle();
        this.checkAuth();
      }

      setupTabs() {
        const tabs = document.querySelectorAll('.login-tab');
        const switchButtons = document.querySelectorAll('.switch-tab');

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const tabId = tab.dataset.tab;
            this.switchTab(tabId);
          });
        });

        switchButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            const tabId = button.dataset.tab;
            this.switchTab(tabId);
          });
        });
      }

      switchTab(tabId) {
        // Update active tab
        document.querySelectorAll('.login-tab').forEach(tab => {
          tab.classList.toggle('active', tab.dataset.tab === tabId);
        });

        // Show corresponding form
        document.querySelectorAll('.form-section').forEach(section => {
          section.classList.toggle('active', section.id === tabId);
        });

        // Clear all errors
        this.clearErrors();
      }

      setupForms() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const resetForm = document.getElementById('resetForm');

        if (loginForm) {
          loginForm.addEventListener('submit', (e) => this.handleLogin(e));
        }

        if (registerForm) {
          registerForm.addEventListener('submit', (e) => this.handleRegister(e));
        }

        if (resetForm) {
          resetForm.addEventListener('submit', (e) => this.handleReset(e));
        }
      }

      handleLogin(e) {
        e.preventDefault();
        this.clearErrors();

        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value.trim();
        let isValid = true;

        // Validate email
        if (!email || !utils.validateEmail(email)) {
          this.showError('loginEmailError', 'Please enter a valid email address');
          isValid = false;
        }

        // Validate password
        if (!password || password.length < 6) {
          this.showError('loginPasswordError', 'Password must be at least 6 characters');
          isValid = false;
        }

        if (isValid) {
          if (auth.login(email, password)) {
            utils.showToast('Login successful!', 'success');
            
            // Check for redirect parameter
            const params = utils.getUrlParams();
            const redirect = params.redirect || 'index.html';
            
            setTimeout(() => {
              window.location.href = redirect;
            }, 1000);
          } else {
            this.showError('loginPasswordError', 'Invalid email or password');
          }
        }
      }

      handleRegister(e) {
        e.preventDefault();
        this.clearErrors();

        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const phone = document.getElementById('registerPhone').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirm').value.trim();
        const acceptTerms = document.getElementById('acceptTerms').checked;
        let isValid = true;

        // Validate name
        if (!name || name.length < 2) {
          this.showError('registerNameError', 'Please enter your full name');
          isValid = false;
        }

        // Validate email
        if (!email || !utils.validateEmail(email)) {
          this.showError('registerEmailError', 'Please enter a valid email address');
          isValid = false;
        }

        // Validate phone
        if (!phone || !utils.validatePhone(phone)) {
          this.showError('registerPhoneError', 'Please enter a valid Nigerian phone number');
          isValid = false;
        }

        // Validate password
        if (!password || password.length < 8) {
          this.showError('registerPasswordError', 'Password must be at least 8 characters');
          isValid = false;
        }

        // Validate password confirmation
        if (password !== confirmPassword) {
          this.showError('registerConfirmError', 'Passwords do not match');
          isValid = false;
        }

        // Validate terms
        if (!acceptTerms) {
          this.showError('termsError', 'You must accept the terms and conditions');
          isValid = false;
        }

        if (isValid) {
          const result = auth.register({
            name,
            email,
            phone,
            password // In production, this should be hashed
          });

          if (result.success) {
            utils.showToast('Account created successfully!', 'success');
            
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 1000);
          } else {
            this.showError('registerEmailError', result.message);
          }
        }
      }

      handleReset(e) {
        e.preventDefault();
        this.clearErrors();

        const email = document.getElementById('resetEmail').value.trim();

        if (!email || !utils.validateEmail(email)) {
          this.showError('resetEmailError', 'Please enter a valid email address');
          return;
        }

        if (auth.resetPassword(email)) {
          utils.showToast('Check your email for reset instructions', 'success');
          setTimeout(() => {
            this.switchTab('login');
          }, 2000);
        }
      }

      setupPasswordToggle() {
        document.querySelectorAll('.toggle-password').forEach(button => {
          button.addEventListener('click', function() {
            const targetId = this.dataset.target;
            const input = document.getElementById(targetId);
            const icon = this.querySelector('i');
            
            if (input.type === 'password') {
              input.type = 'text';
              icon.classList.remove('fa-eye');
              icon.classList.add('fa-eye-slash');
            } else {
              input.type = 'password';
              icon.classList.remove('fa-eye-slash');
              icon.classList.add('fa-eye');
            }
          });
        });
      }

      showError(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = message;
          element.style.display = 'block';
        }
      }

      clearErrors() {
        document.querySelectorAll('.error-message').forEach(element => {
          element.textContent = '';
          element.style.display = 'none';
        });
      }

      checkAuth() {
        // If user is already logged in, redirect to home
        if (auth.isLoggedIn()) {
          window.location.href = 'index.html';
        }
      }
    }

    // Initialize login page
    const loginPage = new LoginPage();
  </script>
</body>
</html>